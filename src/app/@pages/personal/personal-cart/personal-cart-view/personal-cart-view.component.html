<p-toast></p-toast>
<p-confirmDialog [style]="{ width: '50vw' }"></p-confirmDialog>
<ng-container *ngIf="cart">
  <div class="flex flex-column w-full tman-shadow px-5 py-3 border-round mb-4">
    <div class="flex justify-content-between">
      <div class="flex flex-column">
        <h2>Trasferta a {{ city.name }}</h2>
        <p>del {{ eventDate | customDate }}</p>
      </div>
      <div class="flex flex-column align-items-end">
        <h3>Squadra</h3>
        <p>{{ awayTeam.name }}</p>
      </div>
    </div>
    <p-divider></p-divider>
    <div class="flex justify-content-end dialog-buttons">
      <ng-container *ngIf="!cart.isCompleted; else isCompleted">
        <button
          pButton
          pRipple
          icon="pi pi-pencil"
          class="p-button-rounded p-button-outlined mr-2"
          label="Modifica"
          (click)="update()"
        ></button>
        <button
          pButton
          pRipple
          icon="pi pi-check"
          class="p-button-rounded p-button-outlined p-button-success"
          label="Completa"
          (click)="complete()"
        ></button>
      </ng-container>
    </div>
  </div>

  <div class="flex flex-column w-full tman-shadow px-5 py-3 border-round mb-4">
    <div class="flex flex-column mt-5">
      <p class="font-semibold mb-2">Partecipanti</p>
      <p>Calciatori: {{ cart.players }}</p>
      <p>Staff: {{ cart.staffs }}</p>
      <p>Dirigenti: {{ cart.managers }}</p>
      <p class="my-1 text-lg">Totale: {{ totalPax }}</p>
    </div>
    <p-divider></p-divider>
    <div class="flex flex-column mt-1">
      <p class="font-semibold mb-2">Alloggio</p>
      <p>
        {{ hotel }} - dal {{ cart.startDate | customDate }} al
        {{ cart.endDate | customDate }}
      </p>
    </div>
    <p-divider></p-divider>
    <div class="flex flex-column mt-1">
      <p class="font-semibold mb-2">Camere</p>
      <p-table [value]="rooms" [tableStyle]="{ 'min-width': '50rem' }">
        <ng-template pTemplate="header">
          <tr>
            <th>Tipologia</th>
            <th>Quantità</th>
            <th class="text-right">Prezzo</th>
          </tr>
        </ng-template>
        <ng-template pTemplate="body" let-room>
          <tr>
            <td>{{ room.room.name }}</td>
            <td>{{ room.quantity }}</td>
            <td class="text-right">
              {{ room.room.price | currency : "EUR" : "symbol" }}
            </td>
          </tr>
        </ng-template>
      </p-table>
    </div>
    <p-divider></p-divider>
    <div class="flex flex-column mt-1">
      <p class="font-semibold mb-2">Autonoleggio</p>
      <ng-container *ngFor="let r of roads">
        <div class="mb-2">
          <p class="mb-1">Da {{ r.from }} a {{ r.to }}</p>
          <p class="mb-1 text-sm">
            {{ r.startDate | customDate : "showHours" }} -
            {{ r.endDate | customDate : "showHours" }}
          </p>
          <ng-container *ngFor="let v of r.veichles">
            <div class="px-2">{{ v.quantity }}x {{ v.veichle.name }}</div>
          </ng-container>
        </div>
      </ng-container>
    </div>
    <p-divider></p-divider>
    <div class="flex flex-column mt-1">
      <p class="font-semibold mb-2">Attività</p>
      <p-table [value]="activities" [tableStyle]="{ 'min-width': '50rem' }">
        <ng-template pTemplate="header">
          <tr>
            <th>Attività</th>
            <th>Descrizione</th>
            <th class="text-right">Prezzo</th>
            <th>Note</th>
          </tr>
        </ng-template>
        <ng-template pTemplate="body" let-activity>
          <tr>
            <td>{{ activity.activity.name }}</td>
            <td>{{ activity.activity.description }}</td>
            <td class="text-right">
              {{ activity.activity.price | currency : "EUR" : "symbol" }}
            </td>
            <td>{{ activity.note }}</td>
          </tr>
        </ng-template>
      </p-table>
    </div>
    <p-divider></p-divider>
    <div class="flex justify-content-between">
      <p class="font-semibold mb-2">TOTALE</p>
      <p class="text-2xl">{{ total | currency : "EUR" : "symbol" }}</p>
    </div>
  </div>
</ng-container>

<ng-template #isCompleted>
  <p-tag severity="Primary">
    <p>Trasferta confermata il {{ cart.completedAt | customDate }}</p>
  </p-tag>
</ng-template>
